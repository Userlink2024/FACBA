<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario La Zapatería - Sistema Avanzado</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f4f6f8;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 16px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-right: 5px;
        }
        button:hover {
            background-color: #1e7e34;
        }
        #inventory-module {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 6px;
            background-color: #fff;
        }
        h2 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 15px;
        }
        #search-input {
            width: calc(100% - 16px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 15px;
            font-size: 16px;
        }
        .item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .item:last-child {
            border-bottom: none;
        }
        .item-details {
            flex-grow: 1;
            padding-right: 10px;
        }
        .item-details span {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .item-actions {
            display: flex;
            gap: 5px;
        }
        .item-actions button {
            padding: 8px 12px;
            font-size: 14px;
        }
        .edit-input {
            width: 70px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 14px;
            margin-right: 5px;
        }
        .edit-controls {
            display: none;
            margin-left: 10px;
        }
        .item.editing .item-details > span {
            display: none;
        }
        .item.editing .edit-input {
            display: inline;
        }
        .item.editing .edit-controls {
            display: inline;
        }
        #total-value {
            margin-top: 20px;
            font-weight: bold;
            color: #333;
            text-align: right;
            font-size: 18px;
        }
        .quantity-input-group {
            display: none;
        }
        .quantity-input-group.active {
            display: block;
        }
        /* Estilos para móvil */
        @media (max-width: 480px) {
            .container {
                width: 95%;
                margin: 10px auto;
                padding: 15px;
            }
            h1 {
                font-size: 24px;
                margin-bottom: 15px;
            }
            .input-group label {
                font-size: 14px;
            }
            input[type="text"],
            input[type="number"],
            select {
                font-size: 14px;
                padding: 8px;
            }
            button {
                font-size: 14px;
                padding: 8px 10px;
                margin-right: 3px;
            }
            .item-actions button {
                font-size: 12px;
                padding: 5px 8px;
            }
            #search-input {
                font-size: 14px;
                padding: 8px;
                margin-bottom: 10px;
            }
            #total-value {
                font-size: 16px;
            }
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script type="text/javascript">
        const firebaseConfig = {
            apiKey: "AIzaSyCwGpyvoUfbXE4rpPfLmHSdOK_VI4mT24M",
            authDomain: "lazapateria-ce24f.firebaseapp.com",
            projectId: "lazapateria-ce24f",
            storageBucket: "lazapateria-ce24f.firebasestorage.app",
            messagingSenderId: "642571845821",
            appId: "1:642571845821:web:45858a0abc0df728fd77d4",
            measurementId: "G-6JCF33H0K1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const inventoryCollection = db.collection('inventario');

        document.addEventListener('DOMContentLoaded', () => {
            const productInput = document.getElementById('product-name');
            const unitSelect = document.getElementById('unit');
            const metersInput = document.getElementById('meters');
            const centimetersInput = document.getElementById('centimeters');
            const valueInput = document.getElementById('value');
            const addButton = document.getElementById('add-item');
            const inventoryList = document.getElementById('inventory-list');
            const totalValueDisplay = document.getElementById('total-value');
            const searchInput = document.getElementById('search-input');
            const providerInput = document.getElementById('provider');
            const clientInput = document.getElementById('client');
            const quantityInputGroup = document.getElementById('quantity-input-group');
            const quantityInput = document.getElementById('quantity');

            let inventoryData = [];
            let editingId = null;

            const renderInventory = (items) => {
                inventoryList.innerHTML = '';
                let totalValue = 0;
                items.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.classList.add('item');
                    if (editingId === item.id) {
                        listItem.classList.add('editing');
                    }

                    let unitDisplay = item.unit;
                    let quantityDisplay = '';
                    if (item.unit === 'metros') {
                        unitDisplay = `${item.meters || 0} m ${item.centimeters || 0} cm`;
                    } else if (item.unit === 'unidades' && item.quantity !== undefined) {
                        quantityDisplay = `Cantidad: ${item.quantity}`;
                    }

                    listItem.innerHTML = `
                        <div class="item-details">
                            <span>Producto: <span class="product-name">${item.product}</span><input type="text" class="edit-input" value="${item.product}"></span>
                            <span>Unidad: <span class="unit">${unitDisplay}</span>
                                <select class="edit-input unit-select">
                                    <option value="unidades" ${item.unit === 'unidades' ? 'selected' : ''}>Unidades</option>
                                    <option value="metros" ${item.unit === 'metros' ? 'selected' : ''}>Metros</option>
                                </select>
                            </span>
                            ${quantityDisplay ? `<span>${quantityDisplay}<input type="number" class="edit-input quantity-input" value="${item.quantity || 0}"></span>` : ''}
                            <span>Valor: $<span class="value">${item.value ? item.value.toFixed(2) : '0.00'}</span><input type="number" class="edit-input value-input" value="${item.value || 0}"></span>
                            ${item.provider ? `<span>Proveedor: <span class="provider">${item.provider}</span><input type="text" class="edit-input provider-input" value="${item.provider || ''}"></span>` : ''}
                            ${item.client ? `<span>Cliente: <span class="client">${item.client}</span><input type="text" class="edit-input client-input" value="${item.client || ''}"></span>` : ''}
                        </div>
                        <div class="item-actions" data-unit="${item.unit}" data-item-id="${item.id}">
                            <input type="number" class="add-units" placeholder="+ Un" value="0" style="display: ${item.unit === 'unidades' ? 'inline' : 'none'}">
                            <input type="number" class="add-metros" placeholder="+ M" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <input type="number" class="add-centimetros" placeholder="+ Cm" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <button class="action-button add-button">Agregar</button>
                            <input type="number" class="remove-units" placeholder="- Un" value="0" style="display: ${item.unit === 'unidades' ? 'inline' : 'none'}">
                            <input type="number" class="remove-metros" placeholder="- M" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <input type="number" class="remove-centimetros" placeholder="- Cm" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <button class="action-button remove-button">Quitar</button>
                            <button class="action-button edit-button" data-id="${item.id}">Editar</button>
                            <button class="action-button delete-button" data-id="${item.id}">Eliminar</button>
                            <div class="edit-controls">
                                <button class="action-button save-button" data-id="${item.id}">Guardar</button>
                                <button class="action-button cancel-button" data-id="${item.id}">Cancelar</button>
                            </div>
                        </div>
                    `;

                    inventoryList.appendChild(listItem);
                    totalValue += parseFloat(item.value || 0);
                });
                totalValueDisplay.textContent = `Valor Total: $${totalValue.toFixed(2)}`;

                // Event listeners will be added in the second part
            };

            db.collection('inventario').onSnapshot((snapshot) => {
                inventoryData = [];
                snapshot.forEach(doc => {
                    inventoryData.push({ id: doc.id, ...doc.data() });
                });
                renderInventory(inventoryData);
            });

            addButton.addEventListener('click', async () => {
                const product = productInput.value.trim();
                const unit = unitSelect.value;
                let meters = parseInt(metersInput.value) || 0;
                let centimeters = parseInt(centimetersInput.value) || 0;
                const value = parseFloat(valueInput.value);
                const provider = providerInput.value.trim();
                const client = clientInput.value.trim();
                const quantity = unit === 'unidades' ? parseInt(quantityInput.value) || 0 : null;

                if (product && !isNaN(value)) {
                    const newItem = {
                        product: product,
                        unit: unit,
                        value: value,
                        timestamp: new Date()
                    };
                    if (provider) newItem.provider = provider;
                    if (client) newItem.client = client;
                    if (unit === 'metros') {
                        newItem.meters = meters;
                        newItem.centimeters = centimeters;
                    } else if (unit === 'unidades') {
                        newItem.quantity = quantity;
                    }

                    try {
                        await db.collection('inventario').add(newItem);
                        productInput.value = '';
                        metersInput.value = '';
                        centimetersInput.value = '';
                        valueInput.value = '';
                        providerInput.value = '';
                        clientInput.value = '';
                        quantityInput.value = '';
                    } catch (error) {
                        console.error("Error al agregar el documento: ", error);
                    }
                } else {
                    alert('Por favor, ingresa el nombre del producto y un valor válido.');
                }
            });

            unitSelect.addEventListener('change', () => {
                const isMetros = unitSelect.value === 'metros';
                const isUnidades = unitSelect.value === 'unidades';
                document.getElementById('meters-group').style.display = isMetros ? 'block' : 'none';
                document.getElementById('centimeters-group').style.display = isMetros ? 'block' : 'none';
                quantityInputGroup.classList.toggle('active', isUnidades);
                metersInput.value = '';
                centimetersInput.value = '';
                quantityInput.value = '';
            });

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredInventory = inventoryData.filter(item =>
                    item.product.toLowerCase().includes(searchTerm) ||
                    (item.provider && item.provider.toLowerCase().includes(searchTerm)) ||
                    (item.client && item.client.toLowerCase().includes(searchTerm))
                );
                renderInventory(filteredInventory);
            });

            // Inicialmente ocultar los campos de metros y centímetros y cantidad
            document.getElementById('meters-group').style.display = 'none';
            document.getElementById('centimeters-group').style.display = 'none';
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Inventario La Zapatería</h1>

        <div class="input-group">
            <label for="product-name">Nuevo Producto:</label>
            <input type="text" id="product-name" placeholder="Nombre del producto">
        </div>

        <div class="input-group">
            <label for="unit">Unidad de medida:</label>
            <select id="unit">
                <option value="unidades">Unidades</option>
                <option value="metros">Metros</option>
            </select>
        </div>

        <div class="input-group quantity-input-group" id="quantity-input-group">
            <label for="quantity">Cantidad:</label>
            <input type="number" id="quantity" placeholder="Cantidad">
        </div>

        <div class="input-group" id="meters-group">
            <label for="meters">Metros:</label>
            <input type="number" id="meters" placeholder="Metros">
        </div><div class="input-group" id="centimeters-group">
            <label for="centimeters">Centímetros:</label>
            <input type="number" id="centimeters" placeholder="Centímetros">
        </div>

        <div class="input-group">
            <label for="value">Valor:</label>
            <input type="number" id="value" placeholder="Valor del producto">
        </div>

        <div class="input-group">
            <label for="provider">Proveedor:</label>
            <input type="text" id="provider" placeholder="Nombre del proveedor (opcional)">
        </div>

        <div class="input-group">
            <label for="client">Cliente:</label>
            <input type="text" id="client" placeholder="Nombre del cliente (opcional)">
        </div>

        <button id="add-item">Agregar Nuevo Producto</button>

        <div id="inventory-module">
            <h2>Inventario</h2>
            <input type="text" id="search-input" placeholder="Buscar producto...">
            <div id="inventory-list">
                <p>Cargando inventario...</p>
            </div>
            <div id="total-value">
                Valor Total: $0.00
            </div>
        </div>
    </div>

    <script type="text/javascript">
        const firebaseConfig = {
            apiKey: "AIzaSyCwGpyvoUfbXE4rpPfLmHSdOK_VI4mT24M",
            authDomain: "lazapateria-ce24f.firebaseapp.com",
            projectId: "lazapateria-ce24f",
            storageBucket: "lazapateria-ce24f.firebasestorage.app",
            messagingSenderId: "642571845821",
            appId: "1:642571845821:web:45858a0abc0df728fd77d4",
            measurementId: "G-6JCF33H0K1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const inventoryCollection = db.collection('inventario');

        document.addEventListener('DOMContentLoaded', () => {
            const productInput = document.getElementById('product-name');
            const unitSelect = document.getElementById('unit');
            const metersInput = document.getElementById('meters');
            const centimetersInput = document.getElementById('centimeters');
            const valueInput = document.getElementById('value');
            const addButton = document.getElementById('add-item');
            const inventoryList = document.getElementById('inventory-list');
            const totalValueDisplay = document.getElementById('total-value');
            const searchInput = document.getElementById('search-input');
            const providerInput = document.getElementById('provider');
            const clientInput = document.getElementById('client');
            const quantityInputGroup = document.getElementById('quantity-input-group');
            const quantityInput = document.getElementById('quantity');

            let inventoryData = [];
            let editingId = null;

            const renderInventory = (items) => {
                inventoryList.innerHTML = '';
                let totalValue = 0;
                items.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.classList.add('item');
                    if (editingId === item.id) {
                        listItem.classList.add('editing');
                    }

                    let unitDisplay = item.unit;
                    let quantityDisplay = '';
                    if (item.unit === 'metros') {
                        unitDisplay = `${item.meters || 0} m ${item.centimeters || 0} cm`;
                    } else if (item.unit === 'unidades' && item.quantity !== undefined) {
                        quantityDisplay = `Cantidad: ${item.quantity}`;
                    }

                    listItem.innerHTML = `
                        <div class="item-details">
                            <span>Producto: <span class="product-name"><span class="math-inline">\{item\.product\}</span\><input type\="text" class\="edit\-input" value\="</span>{item.product}"></span>
                            <span>Unidad: <span class="unit">${unitDisplay}</span>
                                <select class="edit-input unit-select">
                                    <option value="unidades" ${item.unit === 'unidades' ? 'selected' : ''}>Unidades</option>
                                    <option value="metros" ${item.unit === 'metros' ? 'selected' : ''}>Metros</option>
                                </select>
                            </span>
                            ${quantityDisplay ? `<span>${quantityDisplay}<input type="number" class="edit-input quantity-input" value="${item.quantity || 0}"></span>` : ''}
                            <span>Valor: <span class="math-inline"><span class\="value"\></span>{item.value ? item.value.toFixed(2) : '0.00'}</span><input type="number" class="edit-input value-input" value="${item.value || 0}"></span>
                            ${item.provider ? `<span>Proveedor: <span class="provider">${item.provider}</span><input type="text" class="edit-input provider-input" value="${item.provider || ''}"></span>` : ''}
                            ${item.client ? `<span>Cliente: <span class="client">${item.client}</span><input type="text" class="edit-input client-input" value="${item.client || ''}"></span>` : ''}
                        </div>
                        <div class="item-actions" data-unit="<span class="math-inline">\{item\.unit\}" data\-item\-id\="</span>{item.id}">
                            <input type="number" class="add-units" placeholder="+ Un" value="0" style="display: ${item.unit === 'unidades' ? 'inline' : 'none'}">
                            <input type="number" class="add-metros" placeholder="+ M" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <input type="number" class="add-centimetros" placeholder="+ Cm" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <button class="action-button add-button">Agregar</button>
                            <input type="number" class="remove-units" placeholder="- Un" value="0" style="display: ${item.unit === 'unidades' ? 'inline' : 'none'}">
                            <input type="number" class="remove-metros" placeholder="- M" value="0" style="display: ${item.unit === 'metros' ? 'inline' : 'none'}">
                            <input type="number" class="remove-centimetros" placeholder="- Cm" value="0" style="display: <span class="math-inline">\{item\.unit \=\=\= 'metros' ? 'inline' \: 'none'\}"\>
<button class\="action\-button remove\-button"\>Quitar</button\>
<button class\="action\-button edit\-button" data\-id\="</span>{item.id}">Editar</button>
                            <button class="action-button delete-button" data-id="<span class="math-inline">\{item\.id\}"\>Eliminar</button\>
<div class\="edit\-controls"\>
<button class\="action\-button save\-button" data\-id\="</span>{item.id}">Guardar</button>
                                <button class="action-button cancel-button" data-id="${item.id}">Cancelar</button>
                            </div>
                        </div>
                    `;

                    inventoryList.appendChild(listItem);
                    totalValue += parseFloat(item.value || 0);
                });
                totalValueDisplay.textContent = `Valor Total: $${totalValue.toFixed(2)}`;

                inventoryList.addEventListener('click', async (e) => {
                    if (e.target.classList.contains('add-button')) {
                        const actionsDiv = e.target.parentNode;
                        const itemId = actionsDiv.dataset.itemId;
                        const unit = actionsDiv.dataset.unit;
                        let updateData = {};
                        if (unit === 'unidades') {
                            const addQuantity = parseInt(actionsDiv.querySelector('.add-units').value) || 0;
                            if (addQuantity > 0) {
                                const itemToUpdate = inventoryData.find(item => item.id === itemId);
                                updateData = { quantity: (itemToUpdate.quantity || 0) + addQuantity };
                            }
                        } else if (unit === 'metros') {
                            const addMeters = parseInt(actionsDiv.querySelector('.add-metros').value) || 0;
                            const addCentimeters = parseInt(actionsDiv.querySelector('.add-centimetros').value) || 0;
                            if (addMeters !== 0 || addCentimeters !== 0) {
                                const itemToUpdate = inventoryData.find(item => item.id === itemId);
                                const currentMeters = itemToUpdate.meters || 0;
                                const currentCentimeters = itemToUpdate.centimeters || 0;
                                let newTotalCentimeters = (currentMeters * 100 + currentCentimeters) + (addMeters * 100 + addCentimeters);
                                updateData.meters = Math.floor(newTotalCentimeters / 100);
                                updateData.centimeters = newTotalCentimeters % 100;
                            }
                        }
                        if (Object.keys(updateData).length > 0) {
                            try {
                                await db.collection('inventario').doc(itemId).update(updateData);
                                actionsDiv.querySelectorAll('input[type="number"]').forEach(input => input.value = 0);
                            } catch (error) {
                                console.error("Error al agregar stock: ", error);
                            }
                        }
                    } else if (e.target.classList.contains('remove-button')) {
                        const actionsDiv = e.target.parentNode;
                        const itemId = actionsDiv.dataset.itemId;
                        const unit = actionsDiv.dataset.unit;
                        let updateData = {};
                        if (unit === 'unidades') {
                            const removeQuantity = parseInt(actionsDiv.querySelector('.remove-units').value) || 0;
                            if (removeQuantity > 0) {
                                const itemToUpdate = inventoryData.find(item => item.id === itemId);
                                updateData = { quantity: Math.max(0, (itemToUpdate.quantity || 0) - removeQuantity) };
                            }
                        } else if (unit === 'metros') {
                            const removeMeters = parseInt(actionsDiv.querySelector('.remove-metros').value) || 0;
                            const removeCentimeters = parseInt(actionsDiv.querySelector('.remove-centimetros').value) || 0;
                            if (removeMeters !== 0 || removeCentimeters !== 0) {
                                const itemToUpdate = inventoryData.find(item => item.id === itemId);
                                const currentMeters = itemToUpdate.meters || 0;
                                const currentCentimeters = itemToUpdate.centimeters || 0;
                                let newTotalCentimeters = (currentMeters * 100 + currentCentimeters) - (removeMeters * 100 + removeCentimeters);
                                updateData.meters = Math.max(0, Math.floor(newTotalCentimeters / 100));
                                updateData.centimeters = Math.max(0, newTotalCentimeters % 100);
                            }
                        }
                        if (Object.keys(updateData).length > 0) {
                            try {
                                await db.collection('inventario').doc(itemId).update(updateData);
                                actionsDiv.querySelectorAll('input[type="number"]').forEach(input => input.value = 0);
                            } catch (error) {
                                console.error("Error al quitar stock: ", error);
                            }
                        }
                    } else if (e.target.classList.contains('delete-button')) {
                        const itemIdToDelete = e.target.dataset.id;
                        if (confirm('¿Seguro que quieres eliminar este producto?')) {
                            try {
                                await db.collection('inventario').doc(itemIdToDelete).delete();
                                console.log(`Producto con ID ${itemIdToDelete} eliminado.`);
                            } catch (error) {
                                console.error("Error al eliminar el documento: ", error);
                            }
                        }
                    } else if (e.target.classList.contains('edit-button')) {
                        editingId = e.target.dataset.id;
                        renderInventory(inventoryData); // Re-render para mostrar los campos de edición
                    } else if (e.target.classList.contains('cancel-button')) {
                        editingId = null;
                        renderInventory(inventoryData); // Re-render para ocultar los campos de edición
                    } else if (e.target.classList.contains('save-button')) {
                        const itemIdToUpdate = e.target.dataset.id;
                        const listItem = e.target.closest('.item');
                        const updatedData = {};

                        updatedData.product = listItem.querySelector('.edit-input[type="text"]').value;
                        updatedData.unit = listItem.querySelector('.edit-input.unit-select').value;
                        updatedData.value = parseFloat(listItem.querySelector('.edit-input.value-input').value);
                        const providerInput = listItem.querySelector('.edit-input.provider-input');
                        if (providerInput) updatedData.provider = providerInput.value;
                        const clientInput = listItem.querySelector('.edit-input.client-input');
                        if (clientInput) updatedData.client = clientInput.value;
                        const quantityInputEdit = listItem.querySelector('.edit-input.quantity-input');
                        if (quantityInputEdit && listItem.querySelector('.quantity')) updatedData.quantity = parseInt(quantityInputEdit.value);
                        const metersInputEdit = listItem.querySelector('.edit-input.meters-input');
                        if (metersInputEdit && updatedData.unit === 'metros') updatedData.meters = parseInt(metersInputEdit.value);
                        const centimetersInputEdit = listItem.querySelector('.edit-input.centimeters-input');
                        if (centimetersInputEdit && updatedData.unit === 'metros') updatedData.centimeters = parseInt(centimetersInputEdit.value);

                        try {
                            await db.collection('inventario').doc(itemIdToUpdate).update(updatedData);
                            editingId = null; // Salir del modo edición
                            renderInventory(inventoryData); // Re-render para mostrar los valores actualizados
                        } catch (error) {
                            console.error("Error al guardar las modificaciones: ", error);
                        }
                    }
                });
            };

            db.collection('inventario').onSnapshot((snapshot) => {
                inventoryData = [];
                snapshot.forEach(doc => {
                    inventoryData.push({ id: doc.id, ...doc.data() });
                });
                renderInventory(inventoryData);
            });

            addButton.addEventListener('click', async () => {
                const product = productInput.value.trim();
                const unit = unitSelect.value;
                let meters = parseInt(metersInput.value) || 0;
                let centimeters = parseInt(centimetersInput.value) || 0;
                const value = parseFloat(valueInput.value);
                const provider = providerInput.value.trim();
                const client = clientInput.value.trim();
                const quantity = unit === 'unidades' ? parseInt(quantityInput.value) || 0 : null;

                if (product && !isNaN(value)) {
                    const newItem = {
                        product: product,
                        unit: unit,
                        value: value,
                        timestamp: new Date()
                    };
                    if (provider) newItem.provider = provider;
                    if (client) newItem.client = client;
                    if (unit === 'metros') {
                        newItem.meters = meters;
                        newItem.centimeters = centimeters;
                    } else if (unit === 'unidades') {
                        newItem.quantity = quantity;
                    }

                    try {
                        await db.collection('inventario').add(newItem);
                        productInput.value = '';
                        metersInput.value = '';
                        centimetersInput.value = '';
                        valueInput.value = '';
                        providerInput.value = '';
                        clientInput.value = '';
                        quantityInput.value = '';
                    } catch (error) {
                        console.error("Error al agregar el documento: ", error);
                    }
                } else {
                    alert('Por favor, ingresa el nombre del producto y un valor válido.');
                }
            });

            unitSelect.addEventListener('change', () => {
                const isMetros = unitSelect.value === 'metros';
                const isUnidades = unitSelect.value === 'unidades';
                document.getElementById('meters-group').style.display = isMetros ? 'block' : 'none';
                document.getElementById('centimeters-group').style.display = isMetros ? 'block' : 'none';
                quantityInputGroup.classList.toggle('active', isUnidades);
                metersInput.value = '';
                centimetersInput.value = '';
                quantityInput.value = '';
            });

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredInventory = inventoryData.filter(item =>
                    item.product.toLowerCase().includes(searchTerm) ||
                    (item.provider && item.provider.toLowerCase().includes(searchTerm)) ||
                    (item.client && item.client.toLowerCase().includes(searchTerm))
                );
                renderInventory(filteredInventory);
            });

            // Inicialmente ocultar los campos de metros y centímetros y cantidad
            document.getElementById('meters-group').style.display = 'none';
            document.getElementById('centimeters-group').style.display = 'none';
        });
    </script>
</body>
</html>

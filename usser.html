<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>🔒 Pantalla Secreta</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, onDisconnect, set, push, serverTimestamp } 
  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// 🔥 Configuración Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCimRCv6S5u0FhsfWrW_3A0dQJy0uAKVro",
  authDomain: "facba-69d41.firebaseapp.com",
  databaseURL: "https://facba-69d41-default-rtdb.firebaseio.com",
  projectId: "facba-69d41",
  storageBucket: "facba-69d41.firebasestorage.app",
  messagingSenderId: "264089433073",
  appId: "1:264089433073:web:968551648758972eb74a50",
  measurementId: "G-NL7Y6NDH99"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function iniciarFirebase() {
  // Conexiones activas
  const connectionsRef = ref(db, "/connections");
  const connectedRef = ref(db, ".info/connected");

  onValue(connectedRef, (snap) => {
    if (snap.val() === true) {
      const con = push(connectionsRef);
      set(con, { connectedAt: serverTimestamp() });
      onDisconnect(con).remove();
    }
  });

  onValue(connectionsRef, (snap) => {
    const data = snap.val();
    const count = data ? Object.keys(data).length : 0;
    document.getElementById("onlineCount").textContent = count;
  });

  // Historial de visitas
  const visitasRef = ref(db, "/visitas");
  push(visitasRef, { 
    timestamp: serverTimestamp(),
    fecha: new Date().toLocaleString()
  });

  onValue(visitasRef, (snap) => {
    const data = snap.val();
    const total = data ? Object.keys(data).length : 0;
    document.getElementById("totalVisitas").textContent = total;

    const ul = document.getElementById("listaVisitas");
    ul.innerHTML = '';
    if (data) {
      Object.values(data).slice(-10).reverse().forEach(v => {
        const li = document.createElement('li');
        li.textContent = v.fecha;
        ul.appendChild(li);
      });
    }
  });
}

// Función para mostrar panel solo si clave correcta
function mostrarPanel() {
  const clave = prompt("Ingresa la clave:");
  if(clave === "170518") {
    document.getElementById("cargando").style.display = "none";
    document.getElementById("panel").style.display = "block";
    iniciarFirebase();
  } else {
    alert("Clave incorrecta 🔒");
  }
}
</script>

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at bottom, #000015, #000010 80%);
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  text-align: center;
  padding: 20px;
  margin: 0;
}

#tuerca {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 2em;
  cursor: pointer;
  user-select: none;
  color: #ffd700;
}

h1 { color: #ffd700; margin-bottom: 10px; }
p { color: #ffd700; font-size: 1.2em; margin-bottom: 25px; }
.contador {
  background: rgba(255,255,255,0.1);
  padding: 10px 20px;
  border-radius: 15px;
  color: #ccc;
  font-size: 1.1em;
  margin: 5px 0;
}
ul {
  list-style: none;
  padding: 0;
  max-height: 200px;
  overflow-y: auto;
  text-align: left;
  color: #ffd700;
}
li {
  padding: 3px 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
</style>
</head>
<body>
<div id="tuerca" onclick="mostrarPanel()">⚙️</div>

<div id="cargando">
  <h1>Cargando...</h1>
  <p>⏳</p>
</div>

<div id="panel" style="display:none;">
  <h1>✨ Panel Secreto ✨</h1>
  <div class="contador">👁️ Personas conectadas ahora: <span id="onlineCount">0</span></div>
  <div class="contador">📖 Total de visitas: <span id="totalVisitas">0</span></div>

  <h3>Últimas visitas:</h3>
  <ul id="listaVisitas"></ul>
</div>
</body>
</html>
